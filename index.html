<!DOCTYPE html>
<html lang="zh_Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/ningoy.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/ningoy.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/ningoy.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/ningoy.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="/ningoy.github.io/css/main.css">


<link rel="stylesheet" href="/ningoy.github.io/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"ningoy.github.io","root":"/ningoy.github.io/","scheme":"Muse","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="关爱颈椎成长协会">
<meta property="og:url" content="https://ningoy.github.io/index.html">
<meta property="og:site_name" content="关爱颈椎成长协会">
<meta property="og:locale" content="zh_Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="关爱颈椎成长协会">

<link rel="canonical" href="https://ningoy.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>关爱颈椎成长协会</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/ningoy.github.io/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">关爱颈椎成长协会</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/ningoy.github.io/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/ningoy.github.io/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2018/05/05/561-Array-Partition-I/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2018/05/05/561-Array-Partition-I/" class="post-title-link" itemprop="url">561. Array Partition I</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-05-05 15:42:00" itemprop="dateCreated datePublished" datetime="2018-05-05T15:42:00+08:00">2018-05-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/刷题/" itemprop="url" rel="index"><span itemprop="name">刷题</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/刷题/LeetCode/" itemprop="url" rel="index"><span itemprop="name">LeetCode</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>Given an array of <strong>2n</strong> integers, your task is to group these integers into <strong>n</strong> pairs of integer, say (a1, b1), (a2, b2), …, (an, bn) which makes sum of min(ai, bi) for all i from 1 to n as large as possible. </p>
</blockquote>
<p><strong>Example 1:</strong> </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,4,3,2]</span><br><span class="line"></span><br><span class="line">Output: 4</span><br><span class="line">Explanation: n is 2, and the maximum sum of pairs is 4 = min(1, 2) + min(3, 4).</span><br></pre></td></tr></table></figure>
<p><strong>Note:</strong> </p>
<ol>
<li><strong>n</strong> is a positive integer, which is in the range of [1, 10000].</li>
<li>All the integers in the array will be in the range of [-10000, 10000].</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">arrayPairSum</span><span class="params">(<span class="keyword">int</span>[] nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> res = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span>[] count = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">20001</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i : nums)&#123;</span><br><span class="line">            count[i + <span class="number">10000</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">boolean</span> odd = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count.length; i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(count[i] &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(odd)&#123;</span><br><span class="line">                    res += i - <span class="number">10000</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                odd = !odd;</span><br><span class="line">                count[i]--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2018/03/24/面试题2：实现Singleton模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2018/03/24/面试题2：实现Singleton模式/" class="post-title-link" itemprop="url">面试题2：实现Singleton模式</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-03-24 17:22:02" itemprop="dateCreated datePublished" datetime="2018-03-24T17:22:02+08:00">2018-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/刷题/" itemprop="url" rel="index"><span itemprop="name">刷题</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/刷题/剑指Offer/" itemprop="url" rel="index"><span itemprop="name">剑指Offer</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="一、什么是单例模式"><a href="#一、什么是单例模式" class="headerlink" title="一、什么是单例模式"></a>一、什么是单例模式</h3><p>因程序需要，有时我们只需要某个类同时保留一个对象，不希望有更多对象，此时，我们则应该考虑单例模式的设计。</p>
<h3 id="二、单例模式的特点"><a href="#二、单例模式的特点" class="headerlink" title="二、单例模式的特点"></a>二、单例模式的特点</h3><ol>
<li>单例模式只能有一个实例。</li>
<li>单例模式必须创建自己的唯一实例。</li>
<li>单例模式必须向其他对象提供这一实例。</li>
</ol>
<h3 id="三、单例模式-vs-静态类"><a href="#三、单例模式-vs-静态类" class="headerlink" title="三、单例模式 vs 静态类"></a>三、单例模式 vs 静态类</h3><ol>
<li>单例模式可以继承和被继承，方法可以被override，而静态方法不可以。</li>
<li>静态方法中产生的对象会在执行后被释放，进而被GC清理，不会一直存在于内存中。</li>
<li>静态类会在第一次运行时初始化，单例模式可以有其他的选择，即可以延迟加载。</li>
<li>基于2、3条，由于单例对象往往存在于DAO层，如果反复的初始化和释放，则会占用很多资源，而使用单例模式将其常驻于内存可以更加节约资源。</li>
<li>静态方法有更高的访问效率。</li>
<li>单例模式很容易被测试。</li>
</ol>
<p>几个关于静态类的误解：</p>
<ul>
<li>静态方法常驻内存而实例方法不是。<ul>
<li>实际上，特殊编写的实例方法可以常驻内存，而静态方法需要不断初始化和释放。</li>
</ul>
</li>
<li>静态方法在堆(heap)上，实例方法在栈(stack)上。<ul>
<li>实际上，都是加载到特殊的不可写的代码内存区域中</li>
</ul>
</li>
<li>静态类和单例模式情景的选择<ul>
<li>不需要维持任何状态，仅仅用于全局访问，此时更适合使用静态类。</li>
<li>需要维持一些特定的状态，此时更适合使用单例模式。</li>
</ul>
</li>
</ul>
<h3 id="四、单例模式的实现"><a href="#四、单例模式的实现" class="headerlink" title="四、单例模式的实现"></a>四、单例模式的实现</h3><ol>
<li><p>懒汉模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonDemo instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDemo <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">            instance=<span class="keyword">new</span> SingletonDemo();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上，通过提供一个静态的对象<code>instance</code>，利用<code>private</code>权限的构造方法和<code>getInstance()</code>方法来给予访问者一个单例。</p>
<p>缺点是，没有考虑到线程安全，可能存在多个访问者同时访问，并同时构造了多个对象的问题。之所以叫做懒汉模式，主要是因为此种方法可以非常明显的lazy loading。</p>
<p>针对懒汉模式线程不安全的问题，我们自然想到了，在 <code>getInstance()</code> 方法前加锁，于是就有了第二种实现.</p>
</li>
<li><p>线程安全的懒汉模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonDemo instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingletonDemo <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">            instance=<span class="keyword">new</span> SingletonDemo();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然而并发其实是一种特殊情况，大多时候这个锁占用的额外资源都浪费了，这种打补丁方式写出来的结构效率很低。</p>
</li>
<li><p>饿汉模式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonDemo instance=<span class="keyword">new</span> SingletonDemo();</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDemo <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接在运行这个类的时候进行一次loading，之后直接访问。显然，这种方法没有起到lazy loading的效果，考虑到前面提到的和静态类的对比，这种方法只比静态类多了一个内存常驻而已。</p>
</li>
<li><p>静态类内部加载</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> SingletonDemo instance=<span class="keyword">new</span> SingletonDemo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Singleton has loaded"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDemo <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>枚举方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> SingletonDemo&#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">otherMethods</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Something"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Effective Java作者Josh Bloch 提倡的方式，在我看来简直是来自神的写法。解决了以下三个问题：</p>
<p>(1)自由序列化。</p>
<p>(2)保证只有一个实例。</p>
<p>(3)线程安全。</p>
<p>如果我们想调用它的方法时，仅需要以下操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Hello</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        SingletonDemo.INSTANCE.otherMethods();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>双重校验锁法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> SingletonDemo instance;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">SingletonDemo</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Singleton has loaded"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SingletonDemo <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SingletonDemo.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance==<span class="keyword">null</span>)&#123;</span><br><span class="line">                    instance=<span class="keyword">new</span> SingletonDemo();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来我解释一下在并发时，双重校验锁法会有怎样的情景：</p>
<p>STEP 1. 线程A访问<code>getInstance()</code>方法，因为单例还没有实例化，所以进入了锁定块。</p>
<p>STEP 2. 线程B访问<code>getInstance()</code>方法，因为单例还没有实例化，得以访问接下来代码块，而接下来代码块已经被线程1锁定。</p>
<p>STEP 3. 线程A进入下一判断，因为单例还没有实例化，所以进行单例实例化，成功实例化后退出代码块，解除锁定。</p>
<p>STEP 4. 线程B进入接下来代码块，锁定线程，进入下一判断，因为已经实例化，退出代码块，解除锁定。</p>
<p>STEP 5. 线程A获取到了单例实例并返回，线程B没有获取到单例并返回Null。</p>
<p>理论上双重校验锁法是线程安全的，并且，这种方法实现了<code>lazyloading</code>。</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2018/03/17/1076-Wifi密码（15）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2018/03/17/1076-Wifi密码（15）/" class="post-title-link" itemprop="url">1076. Wifi密码（15）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2018-03-17 20:06:59" itemprop="dateCreated datePublished" datetime="2018-03-17T20:06:59+08:00">2018-03-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/刷题/" itemprop="url" rel="index"><span itemprop="name">刷题</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/刷题/PAT（Basic-Level）Practice/" itemprop="url" rel="index"><span itemprop="name">PAT（Basic Level）Practice</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>下面是微博上流传的一张照片：“各位亲爱的同学们，鉴于大家有时需要使用wifi，又怕耽误亲们的学习，现将wifi密码设置为下列数学题答案：A-1；B-2；C-3；D-4；请同学们自己作答，每两日一换。谢谢合作！！~”—— 老师们为了促进学生学习也是拼了…… 本题就要求你写程序把一系列题目的答案按照卷子上给出的对应关系翻译成wifi的密码。这里简单假设每道选择题都有4个选项，有且只有1个正确答案。</p>
<p><img src="http://nos.patest.cn/pp_ozun9idw8pr.jpg" alt="微博上流传的一张图片"></p>
<p><strong>输入格式：</strong></p>
<p>输入第一行给出一个正整数N（&lt;= 100），随后N行，每行按照“编号-答案”的格式给出一道题的4个选项，“T”表示正确选项，“F”表示错误选项。选项间用空格分隔。</p>
<p><strong>输出格式：</strong></p>
<p>在一行中输出wifi密码。</p>
<p>输入样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">A-T B-F C-F D-F</span><br><span class="line">C-T B-F A-F D-F</span><br><span class="line">A-F D-F C-F B-T</span><br><span class="line">B-T A-F C-F D-F</span><br><span class="line">B-F D-T A-F C-F</span><br><span class="line">A-T C-F B-F D-F</span><br><span class="line">D-T B-F C-F A-F</span><br><span class="line">C-T A-F B-F D-F</span><br></pre></td></tr></table></figure>
<p>输出样例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">13224143</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> Pattern pattern = Pattern.compile(<span class="string">"\\w-T"</span>);</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Scanner scanner = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">    <span class="keyword">int</span> n = scanner.nextInt();</span><br><span class="line">    scanner.nextLine(); <span class="comment">// 读掉数字后面的一个回车符</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">      Matcher matcher = pattern.matcher(scanner.nextLine());</span><br><span class="line">      <span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">        System.out.print(matcher.group().charAt(<span class="number">0</span>) - <span class="string">'A'</span> + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    scanner.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/11/29/导入CSV文件到MySQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/11/29/导入CSV文件到MySQL/" class="post-title-link" itemprop="url">导入CSV文件到MySQL</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-11-29 19:37:44" itemprop="dateCreated datePublished" datetime="2017-11-29T19:37:44+08:00">2017-11-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数据挖掘/" itemprop="url" rel="index"><span itemprop="name">数据挖掘</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数据挖掘/数据集选取或构建/" itemprop="url" rel="index"><span itemprop="name">数据集选取或构建</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>从网上下载了一个<a href="https://www.capitalbikeshare.com/system-data" target="_blank" rel="noopener">公开数据集</a>，想要用来做一点小实验。下载之后发现这是一个<code>.csv</code>格式的文件，里面大概有50多万条数据。那么下一步就是要把这些数据导入到数据库里。</p>
<h3 id="方案一"><a href="#方案一" class="headerlink" title="方案一"></a>方案一</h3><p>用<code>python</code>的<code>pymysql</code>库来操作，先连接数据库，然后创建数据表，再构造出<code>sql</code>语句，把数据一条一条导进去。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    start = time.time()</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'2016-Q1-Trips-History-Data.csv'</span>, <span class="string">'r'</span>) <span class="keyword">as</span> csv_file:</span><br><span class="line">        spam_reader = csv.reader(csv_file, delimiter=<span class="string">','</span>)</span><br><span class="line">        headers = next(spam_reader)</span><br><span class="line">        db = pymysql.connect(<span class="string">'localhost'</span>, <span class="string">'username'</span>, <span class="string">'password'</span>, <span class="string">'tripshistorydata'</span>)</span><br><span class="line">        cursor = db.cursor()</span><br><span class="line">        cursor.execute(<span class="string">'DROP TABLE IF EXISTS temp;'</span>)</span><br><span class="line">        sql = <span class="string">"""</span></span><br><span class="line"><span class="string">            create table temp(</span></span><br><span class="line"><span class="string">            Duration int not null,</span></span><br><span class="line"><span class="string">            StartDate char(50) not null,</span></span><br><span class="line"><span class="string">            EndDate char(50) not null,</span></span><br><span class="line"><span class="string">            StartStationNumber int not null,</span></span><br><span class="line"><span class="string">            StartStation char(100) not null,</span></span><br><span class="line"><span class="string">            EndStationNumber int not null,</span></span><br><span class="line"><span class="string">            EndStation char(100) not null,</span></span><br><span class="line"><span class="string">            BikeNumber Char(50) not null,</span></span><br><span class="line"><span class="string">            MemberType char(50) not null);</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> spam_reader:</span><br><span class="line">            param = (</span><br><span class="line">                int(row[<span class="number">0</span>]), row[<span class="number">1</span>], row[<span class="number">2</span>], int(row[<span class="number">3</span>]), row[<span class="number">4</span>], int(row[<span class="number">5</span>]), row[<span class="number">6</span>], row[<span class="number">7</span>], row[<span class="number">8</span>]</span><br><span class="line">            )</span><br><span class="line">            sql = <span class="string">"""insert into temp(</span></span><br><span class="line"><span class="string">            Duration, StartDate, EndDate, StartStationNumber, StartStation, EndStationNumber, EndStation, BikeNumber, MemberType</span></span><br><span class="line"><span class="string">            ) values(%s, %s, %s, %s, %s, %s, %s, %s, %s);"""</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cursor.execute(sql, param)</span><br><span class="line">                db.commit()</span><br><span class="line">                <span class="comment"># 记住这句话</span></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">                db.rollback()</span><br><span class="line">        </span><br><span class="line">        db.close()</span><br><span class="line">    stop = time.time()</span><br><span class="line">    cost = stop - start</span><br><span class="line">    print(cost)</span><br></pre></td></tr></table></figure>
<p>但是吧，这么写实在太慢，睡了一个午觉还没导入完。那不行啊，那么有没有更快的办法呢？</p>
<h3 id="方案二"><a href="#方案二" class="headerlink" title="方案二"></a>方案二</h3><p>答案当然是有的，为什么会那么慢，那是因为每一次<code>insert</code>的时候都会<code>commit</code>一次，这样当然会消耗很多时间。如果等所有数据都<code>insert</code>之后，只执行一次<code>commit</code>，当然就会快很多了。</p>
<p>然后嘞，还可以去<code>my.ini</code>里修改<code>innodb_flush_log_at_trx_commit</code>这么一个参数。</p>
<ul>
<li><p>当<code>innodb_flush_log_at_trx_commit=1</code>时，每次事务提交时MySQL都会把<code>log buffer</code>的数据写入<code>log file</code>，并且flush，该模式为系统默认。</p>
<blockquote>
<p>该模式是最安全的，但也是最慢的一种方式。在<code>mysqld</code>服务崩溃或者服务器主机<code>crash</code>的情况下，<code>binary log</code>只有可能丢失最多一个语句或者一个事务。</p>
</blockquote>
</li>
<li><p>当<code>innodb_flush_log_at_trx_commit=0</code>时，<code>log buffer</code>将每秒一次地写入<code>log file</code>中，并且<code>log file</code>的flush操作同时进行。该模式下在事务提交的时候，不会主动触发写入磁盘的操作。</p>
<blockquote>
<p>该模式速度最快，但不太安全，<code>mysqld</code>进程的崩溃会导致上一秒钟所有事务数据的丢失。</p>
</blockquote>
</li>
<li><p>当<code>innodb_flush_log_at_trx_commit=2</code>时，每次事务提交时MySQL都会把<code>log buffer</code>的数据写入<code>log file</code>，但是flush操作并不会同时进行。该模式下，MySQL会每秒执行一次 flush操作。</p>
<blockquote>
<p>该模式速度较快，也比<code>innodb_flush_log_at_trx_commit=0</code>安全，只有在操作系统崩溃或者系统断电的情况下，上一秒钟所有事务数据才可能丢失。</p>
</blockquote>
</li>
</ul>
<p>综合起来，设置<code>innodb_flush_log_at_trx_commit=2</code>，然后重启MySQL服务器</p>
<p>看看这次需要多长的时间。</p>
<font color="red">264.5988073348999s</font>

<h3 id="方案三"><a href="#方案三" class="headerlink" title="方案三"></a>方案三</h3><p><strong>MySQL有一个高效的导入方法，那就是<code>load data infile</code>。 </strong></p>
<p>语法如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">load</span> <span class="keyword">data</span>  [<span class="keyword">low_priority</span>] [<span class="keyword">local</span>] <span class="keyword">infile</span> <span class="string">'file_name txt'</span> [<span class="keyword">replace</span> | <span class="keyword">ignore</span>]</span><br><span class="line"><span class="keyword">into</span> <span class="keyword">table</span> tbl_name</span><br><span class="line">[<span class="keyword">fields</span></span><br><span class="line">[<span class="keyword">terminated</span> <span class="keyword">by</span><span class="string">'t'</span>]</span><br><span class="line">[<span class="keyword">OPTIONALLY</span>] <span class="keyword">enclosed</span> <span class="keyword">by</span> <span class="string">''</span>]</span><br><span class="line">[<span class="keyword">escaped</span> <span class="keyword">by</span><span class="string">'\' ]]</span></span><br><span class="line"><span class="string">[lines terminated by'</span>n<span class="string">']</span></span><br><span class="line"><span class="string">[ignore number lines]</span></span><br><span class="line"><span class="string">[(col_name,   )]</span></span><br></pre></td></tr></table></figure>
<p><code>load data infile</code>语句从一个文本文件中以很高的速度读入一个表中。使用这个命令之前，<code>mysqld</code>进程（服务）必须已经在运行。为了安全原因，当读取位于服务器上的文本文件时，文件必须处于数据库目录或可被所有人读取。另外，为了对服务器上文件使用<code>load data infile</code>，在服务器主机上你必须有<code>file</code>的权限。</p>
<ol>
<li>如果你指定关键词<code>low_priority</code>，那么MySQL将会等到没有其他人读这个表的时候，才把插入数据。</li>
<li>如果指定<code>local</code>关键词，则表明从客户主机读文件。如果没指定<code>local</code>，文件必须位于服务器上。</li>
<li><code>replace</code>和<code>ignore</code>关键词控制对现有的唯一键记录的重复的处理。如果你指定<code>replace</code>，新行将代替有相同的唯一键值的现有行。如果你指定<code>ignore</code>，跳过有唯一键的现有行的重复行的输入。如果你不指定任何一个选项，当找到重复键时，出现一个错误，并且文本文件的余下部分被忽略。</li>
<li>分隔符<ol>
<li><code>fields</code>关键字指定了文件记段的分割格式，如果用到这个关键字，MySQL剖析器希望看到至少有下面的一个选项：<ul>
<li><code>terminated by</code> 字段的分隔符</li>
<li><code>enclosed by</code> 字段括起字符</li>
<li><code>escaped by</code>  转义字符\</li>
</ul>
</li>
</ol>
</li>
</ol>
<p>代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> <span class="keyword">INFILE</span> <span class="string">'FileName'</span> <span class="keyword">REPLACE</span> </span><br><span class="line"><span class="keyword">INTO</span> <span class="keyword">TABLE</span> TableName</span><br><span class="line"><span class="keyword">FIELDS</span> </span><br><span class="line"><span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">','</span> </span><br><span class="line"><span class="keyword">OPTIONALLY</span> <span class="keyword">ENCLOSED</span> <span class="keyword">BY</span> <span class="string">''</span></span><br><span class="line"><span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'\n'</span></span><br><span class="line"><span class="keyword">IGNORE</span> <span class="number">1</span> <span class="keyword">lines</span>;</span><br></pre></td></tr></table></figure>
<font color="red">64.813s</font>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/11/18/求N以内素数的Python实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/11/18/求N以内素数的Python实现/" class="post-title-link" itemprop="url">求N以内质数的Python实现</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-11-18 17:09:24" itemprop="dateCreated datePublished" datetime="2017-11-18T17:09:24+08:00">2017-11-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数据结构与算法/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="质数的定义"><a href="#质数的定义" class="headerlink" title="质数的定义"></a>质数的定义</h2><p>质数（prime number）又称素数，有无限个。除了1和它本身以外不再有其他的除数整除。</p>
<h3 id="Normal"><a href="#Normal" class="headerlink" title="Normal"></a>Normal</h3><p>首先来看一个最<code>normal</code>的实现方式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_1</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n):</span><br><span class="line">        <span class="comment"># 要判断n是不是一个质数 就要看能不能在2到n之间找到一个可以被n整除的除数</span></span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primes_3</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> prime(i):</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><img src="http://op7aviu2v.bkt.clouddn.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image/png/Normal.png" alt="Normal"></p>
<p>这是求N以内的质数最简单的一种方式，所消耗的时间也很多。那么有没有更快的方法呢？</p>
<h3 id="埃氏筛"><a href="#埃氏筛" class="headerlink" title="埃氏筛"></a>埃氏筛</h3><p><a href="https://baike.baidu.com/item/%E5%9F%83%E6%8B%89%E6%89%98%E6%96%AF%E7%89%B9%E5%B0%BC" target="_blank" rel="noopener">埃拉托斯特尼</a>筛法，简称埃氏筛或爱氏筛，是一种由希腊数学家埃拉托斯特尼所提出的一种简单检定质数的算法。</p>
<p>给出要筛数值的范围n，找出以内的质数。先用2去筛，即把2留下，把2的倍数剔除掉；再用下一个质数，也就是3筛，把3留下，把3的倍数剔除掉；接下去用下一个质数5筛，把5留下，把5的倍数剔除掉；不断重复下去……</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primes_1</span><span class="params">(n)</span>:</span></span><br><span class="line">    p = []</span><br><span class="line">    f = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">2</span> <span class="keyword">and</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            f.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f.append(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 筛去所有大于2的偶数</span></span><br><span class="line">    i = <span class="number">3</span></span><br><span class="line">    <span class="keyword">while</span> i * i &lt;= n:</span><br><span class="line">        <span class="comment"># 在3到根号n之间寻找能整除3到n之间的奇数的除数</span></span><br><span class="line">        <span class="comment"># 用这些除数筛掉奇数中的合数 得到的就是质数</span></span><br><span class="line">        <span class="keyword">if</span> f[i] == <span class="number">0</span>:</span><br><span class="line">            j = i * i</span><br><span class="line">            <span class="keyword">while</span> j &lt;= n:</span><br><span class="line">                f[j] = <span class="number">1</span></span><br><span class="line">                j += <span class="number">2</span> * i</span><br><span class="line">                <span class="comment"># 在筛去一轮偶数之后剩下的都是奇数 如果这个奇数是合数</span></span><br><span class="line">                <span class="comment"># 则该奇数的两个除数也应该都是奇数</span></span><br><span class="line">                <span class="comment"># i是奇数 i*i也是奇数 同样的j = i*i + 偶数 * i也应该是奇数</span></span><br><span class="line">        i += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    p.append(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">3</span>, n + <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> f[x] == <span class="number">0</span>:</span><br><span class="line">            p.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure>
<p><img src="http://op7aviu2v.bkt.clouddn.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image/png/Normal_%E5%9F%83%E6%B0%8F%E7%AD%9B.png" alt="Normal_埃氏筛"></p>
<p>那么还有没有更快的方法呢？</p>
<h3 id="开根号法"><a href="#开根号法" class="headerlink" title="开根号法"></a>开根号法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prime_2</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, int(math.sqrt(n)+<span class="number">1</span>)):</span><br><span class="line">        <span class="comment"># 要判断n是不是一个质数 就要看能不能在2到n之间找到一个可以被n整除的除数</span></span><br><span class="line">        <span class="comment"># 假设存在这样一个除数a 使得a * b = n 那么a b之中必有一个数大于根号n</span></span><br><span class="line">        <span class="comment"># 因此 只要小于或等于根号n的数（1除外）不能整除n 则n一定是质数</span></span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primes_4</span><span class="params">(n)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, n+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> prime_2(i):</span><br><span class="line">            <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p><img src="http://op7aviu2v.bkt.clouddn.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image/png/Normal_%E5%9F%83%E6%B0%8F%E7%AD%9B_%E5%BC%80%E6%A0%B9%E5%8F%B7%E6%B3%95.png" alt="Normal_埃氏筛_开根号法"></p>
<p>那么如果埃氏筛也使用了开根号法，会不会更快呢？</p>
<h3 id="埃氏筛加开根号法"><a href="#埃氏筛加开根号法" class="headerlink" title="埃氏筛加开根号法"></a>埃氏筛加开根号法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primes_1</span><span class="params">(n)</span>:</span></span><br><span class="line">    p = []</span><br><span class="line">    f = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i &gt; <span class="number">2</span> <span class="keyword">and</span> i % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">            f.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f.append(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># 筛去所有大于2的偶数</span></span><br><span class="line">    i = <span class="number">3</span></span><br><span class="line">    <span class="keyword">while</span> i * i &lt;= n:</span><br><span class="line">        <span class="comment"># 在3到根号n之间寻找能整除3到n之间的奇数的除数</span></span><br><span class="line">        <span class="comment"># 用这些除数筛掉奇数中的合数 得到的就是质数</span></span><br><span class="line">        <span class="keyword">if</span> f[i] == <span class="number">0</span>:</span><br><span class="line">            j = i * i</span><br><span class="line">            <span class="keyword">while</span> j &lt;= n:</span><br><span class="line">                f[j] = <span class="number">1</span></span><br><span class="line">                j += <span class="number">2</span> * i</span><br><span class="line">                <span class="comment"># 在筛去一轮偶数之后剩下的都是奇数 如果这个奇数是合数</span></span><br><span class="line">                <span class="comment"># 则该奇数的两个除数也应该都是奇数</span></span><br><span class="line">                <span class="comment"># i是奇数 i*i也是奇数 同样的j = i*i + 偶数 * i也应该是奇数</span></span><br><span class="line">        i += <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    p.append(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">3</span>, n + <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> f[x] == <span class="number">0</span>:</span><br><span class="line">            p.append(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> p</span><br></pre></td></tr></table></figure>
<p><img src="http://op7aviu2v.bkt.clouddn.com/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/image/png/Normal_%E5%9F%83%E6%B0%8F%E7%AD%9B_%E5%BC%80%E6%A0%B9%E5%8F%B7%E6%B3%95_%E5%9F%83%E6%B0%8F%E7%AD%9B%E5%8A%A0%E5%BC%80%E6%A0%B9%E5%8F%B7%E6%B3%95.png" alt="Normal_埃氏筛_开根号法_埃氏筛加开根号法"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/11/11/Uploadify插件的使用及兼容性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/11/11/Uploadify插件的使用及兼容性/" class="post-title-link" itemprop="url">Uploadify插件的使用及兼容性</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-11-11 19:02:59" itemprop="dateCreated datePublished" datetime="2017-11-11T19:02:59+08:00">2017-11-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/错误、调试和测试/" itemprop="url" rel="index"><span itemprop="name">错误、调试和测试</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/错误、调试和测试/调试/" itemprop="url" rel="index"><span itemprop="name">调试</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="情境"><a href="#情境" class="headerlink" title="情境"></a>情境</h2><p>要把一个使用Java编写的免费开源的轻量级CMS系统部署到服务器上，主要包括后台权限系统、CMS栏目系统、内容发布系统、简约风格换肤系统。这个系统选用的技术如下：</p>
<table>
<thead>
<tr>
<th>后端</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>核心框架</td>
<td>Spring Framework 4.2.5</td>
</tr>
<tr>
<td>安全框架</td>
<td>Apache Shiro 1.3.2</td>
</tr>
<tr>
<td>视图框架</td>
<td>Spring MVC 4.2.5</td>
</tr>
<tr>
<td>缓存框架</td>
<td>Ehcache</td>
</tr>
<tr>
<td>数据库连接池</td>
<td>Tomcat JDBC</td>
</tr>
<tr>
<td>ORM框架</td>
<td>Spring Data JPA、Hibernate 4.3.5</td>
</tr>
<tr>
<td>日志管理</td>
<td>SLF4J 1.7.21、Log4j</td>
</tr>
<tr>
<td>编辑器</td>
<td>ueditor</td>
</tr>
<tr>
<td>工具类</td>
<td>Apache Commons、Jackson 2.8.5、POI 3.15</td>
</tr>
<tr>
<td>view层</td>
<td>JSP</td>
</tr>
<tr>
<td>数据库</td>
<td>MySQL、Oracle等关系型数据库</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>前端</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>DOM</td>
<td>jquery</td>
</tr>
<tr>
<td>分页</td>
<td>jquery</td>
</tr>
<tr>
<td>UI管理</td>
<td>common</td>
</tr>
<tr>
<td>UI集成</td>
<td>uiExtend</td>
</tr>
<tr>
<td>滚动条</td>
<td>jquery.nicescroll.min.js</td>
</tr>
<tr>
<td>图表</td>
<td>highcharts</td>
</tr>
<tr>
<td>3D图表</td>
<td>highcharts-more</td>
</tr>
<tr>
<td>轮播图</td>
<td>jquery-swipe</td>
</tr>
<tr>
<td>表单提交</td>
<td>jquery.form</td>
</tr>
<tr>
<td>文件上传</td>
<td>jquery.uploadify</td>
</tr>
<tr>
<td>表单验证</td>
<td>jquery.validator</td>
</tr>
<tr>
<td>展现树</td>
<td>jquery.ztree</td>
</tr>
<tr>
<td>html模版引擎</td>
<td>template</td>
</tr>
</tbody>
</table>
<p>在系统后台发布文章的时候，可以为文章添加一个封面<code>CoverImageUrl</code>。然而，当我选中本地的图片，点击上传之后，却发现图片并没有上传。点击保存之后，前台页面也没有出现文章的封面。</p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><ol>
<li><p>搞明白自己遇到的问题是什么？</p>
<ul>
<li>在系统的后台管理界面发布文章时，给文章添加封面。实质上就是 一个上传图片（图片从本地移动到系统指定的路径下），并把图片的相关数据存进数据库的一个过程。</li>
<li>当浏览器访问文章时，再从数据库中取出图片的相关数据，渲染出来就可以了。</li>
</ul>
</li>
<li><p>搞明白是哪里出了问题？</p>
<ul>
<li><p>从数据流来看，图片数据就是经过前端到达后台再进入数据库的。那么是这中间的哪一环出了问题？</p>
</li>
<li><p>首先检查数据库，文章封面对应的字段<code>CoverImageUrl</code>的值没有变化，说明没有改变数据库的数据。</p>
</li>
<li><p>然后调试后台的Java代码<code>UploadController.java</code>，发现数据根本就没有传到后台。这就说明是在前台出问题的。</p>
</li>
<li><p>那么检查前台的代码，盯着看了很久还是没有发现问题，调试的时候发现，数据甚至没有传到前台的代码里，百思不得其解，在这个地方卡了很久。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span> <span class="attr">class</span>=<span class="string">"l_title w200"</span>&gt;</span>图片：<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"J_toolsBar fl"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">" w200 ml10"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">label</span>&gt;</span> </span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">id</span>=<span class="string">"attachImage"</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">"#attachImage"</span>).uploadify(</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="string">'swf'</span> : <span class="string">'$&#123;pageContext.request.contextPath&#125;/static/js/uploadify/uploadify.swf'</span>,</span><br><span class="line">			<span class="string">'uploader'</span> : <span class="string">'$&#123;pageContext.request.contextPath&#125;/upload/uploadAttach'</span>,</span><br><span class="line">			<span class="string">'cancelImg'</span> : <span class="string">'$&#123;pageContext.request.contextPath&#125;/static/js/uploadify/uploadify-cancel.png'</span>,</span><br><span class="line">			<span class="string">'queueID'</span> : <span class="string">'fileQueue'</span>,</span><br><span class="line">			<span class="string">'auto'</span> : <span class="literal">true</span>,</span><br><span class="line">			<span class="string">'multi'</span> : <span class="literal">false</span>,</span><br><span class="line">			<span class="string">'simUploadLimit'</span> : <span class="number">1</span>,</span><br><span class="line">			<span class="string">'buttonText'</span> : <span class="string">'上传图片'</span>,</span><br><span class="line">			<span class="string">'fileObjName'</span> : <span class="string">'fileData'</span>,</span><br><span class="line">			<span class="string">'width'</span> : <span class="number">70</span>,</span><br><span class="line">			<span class="string">'height'</span> : <span class="number">20</span>,</span><br><span class="line">			<span class="string">'uploadLimit'</span>:<span class="number">3</span>,</span><br><span class="line">			<span class="string">'onUploadSuccess'</span> : <span class="function"><span class="keyword">function</span>(<span class="params">file, data, response</span>) </span>&#123;</span><br><span class="line">					<span class="keyword">if</span>(data != <span class="literal">null</span>)&#123;</span><br><span class="line">						<span class="keyword">var</span> attachUrl = <span class="string">'$&#123;pageContext.request.contextPath&#125;'</span> + data;								</span><br><span class="line">						$(<span class="string">"#attachURL"</span>).attr(<span class="string">'src'</span>,attachUrl); </span><br><span class="line">						$(<span class="string">"#coverImageUrl"</span>).val(data);</span><br><span class="line">					&#125;</span><br><span class="line">		 &#125;</span><br><span class="line">	   &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>后来灵机一动，直接搜索<code>uploadify</code>，了解了一下这个控件。发现有很多使用这个控件无法上传图片的情况，一个一个点进去看，有关于jQuery包的导入顺序的，有基于cookie信息验证身份的等等，最后确定是flash插件没有更新，终于把这个问题解决了。</p>
</li>
</ul>
</li>
<li><p>总结一下检查的步骤</p>
<ol>
<li><strong>检查是否安装Flash插件</strong><ul>
<li>如果检查完毕，发现没有安装，需要根据你浏览器类别，浏览器版本来进行下载对应的Flash版本，这也就是该插件的一大坑，Flash插件强关联操作系统，强关联浏览器类别，强关联具体某一类浏览器的版本。如，实际兼容Firefox4.0过程中，Flash版本对应Flash for Firefox 10，其他的版本安装上也不能使用。即IE，Firefox，chrome需要下载不同的Flash安装。</li>
</ul>
</li>
<li><strong>Firefox兼容问题</strong><ul>
<li>在项目中，处于安全性考虑，每次请求必然会做合法性校验，即请求经过相关过滤器，而登录过滤器会根据<code>sessionid</code>获取用户session登录信息。而Firefox使用Flash上传文件时，Flash本身的bug导致提交时不会带上<code>session cookie</code>，而HTTP是无状态请求，session的存在以客户端和服务端的交换标志而延续。而session的<code>sessionid</code>是存储在cookie中的，导致请求不合法。</li>
<li>解决方案一<ul>
<li>采用插件自身的<code>formData</code>属性实现</li>
</ul>
</li>
<li>解决方案二<ul>
<li>在原有请求后加上<code>;jsessionid=${pageContext.session.id}</code></li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><strong>最后总结一下Debug之道</strong></p>
<ul>
<li>首先要摸清楚数据流，搞明白问题出在哪里。</li>
<li>要科学地利用搜索工具，你遇到的问题，别人有可能已经遇到过了，并早已经把解决方案发布在互联网上了。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/10/30/你只有10只小白鼠和一星期的时间，如何检验出哪个瓶子里有毒药？/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/10/30/你只有10只小白鼠和一星期的时间，如何检验出哪个瓶子里有毒药？/" class="post-title-link" itemprop="url">你只有10只小白鼠和一星期的时间，如何检验出哪个瓶子里有毒药？</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-30 19:12:27" itemprop="dateCreated datePublished" datetime="2017-10-30T19:12:27+08:00">2017-10-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数学/" itemprop="url" rel="index"><span itemprop="name">数学</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数学/趣味数学/" itemprop="url" rel="index"><span itemprop="name">趣味数学</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>有 1000 个一模一样的瓶子，其中有 999 瓶是普通的水，有一瓶是毒药。任何喝下毒药的生物都会在一星期之后死亡。现在，你只有 10 只小白鼠和一星期的时间，如何检验出哪个瓶子里有毒药？</p>
</blockquote>
<ol>
<li><p>把1000瓶标号：1, 2, 3, 4, 5, 6 …1000。</p>
</li>
<li><p>所有老鼠排列在一起组成一个2进制队列: 0000000000，其中0代表不喝，1代表喝。</p>
</li>
<li><p>0000000001代表第一瓶水被喝情况</p>
<p>0000000010代表第二瓶水被喝情况</p>
<p>0000000011代表第三瓶水被喝情况</p>
<p>0000000100代表第四瓶水被喝情况</p>
<p>…</p>
<p>1111101000代表第1000瓶水被喝情况</p>
</li>
<li><p>第7天，喝了毒药的老鼠都死了，那个二进制队列转为为十进制就是毒药的标号。</p>
</li>
</ol>
<p>比如第3只老鼠死亡，其他老鼠没死，队列为0000000100，第四瓶水有毒。第1,  5,  6,  8老鼠死亡，其他没死，队列为0010110001，第177瓶水有毒。</p>
<p>作者：kirch</p>
<p>链接：<a href="https://www.zhihu.com/question/19676641/answer/14123096" target="_blank" rel="noopener">https://www.zhihu.com/question/19676641/answer/14123096</a></p>
<p>来源：知乎著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/10/26/MySQL中删除重复数据只保留一条/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/10/26/MySQL中删除重复数据只保留一条/" class="post-title-link" itemprop="url">MySQL中删除重复数据只保留一条</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-26 11:24:58" itemprop="dateCreated datePublished" datetime="2017-10-26T11:24:58+08:00">2017-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数据挖掘/" itemprop="url" rel="index"><span itemprop="name">数据挖掘</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/数据挖掘/数据清洗/" itemprop="url" rel="index"><span itemprop="name">数据清洗</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MySQL中删除重复数据只保留一条"><a href="#MySQL中删除重复数据只保留一条" class="headerlink" title="MySQL中删除重复数据只保留一条"></a>MySQL中删除重复数据只保留一条</h1><h2 id="情境"><a href="#情境" class="headerlink" title="情境"></a>情境</h2><p>数据库中有一张表<code>bone</code> ，有如下字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lblCollectionUnicode, lblTitleName, lblRegisterType, lblType, lblFunctions, lblDimension, lblChineseDisplay, lblWestDisplay, lblDescription, imgShowImage</span><br></pre></td></tr></table></figure>
<p>其中有几条数据因为插入了多次，所以是完全重复的，现在要求去除掉重复数据只保留一条。</p>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>首先确定一个应该具有唯一性的字段，比如<code>lblCollectionUnicode</code> 。然后利用<code>SELECT</code> 语句找出所有<code>lblCollectionUnicode</code> 字段重复的元组，并依照其<code>lblCollectionUnicode</code> 字段的值进行分组。再利用<code>MIN()</code> 函数找出每个分组中<code>auto_increment</code> 字段（即自动增长字段，必须被定义为主键使用）值最小或最大的元组，将其保留，而将其他数据删去。</p>
<p>由于这张表中还没有<code>auto_increment</code>字段，因此首先要创建这个字段。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> new_bone <span class="keyword">LIKE</span> bone;   </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> new_bone <span class="keyword">SELECT</span> * <span class="keyword">FROM</span> bone;</span><br></pre></td></tr></table></figure>
<p>首先将表备份。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> bone <span class="keyword">add</span> <span class="keyword">column</span> _id <span class="built_in">int</span> auto_increment <span class="keyword">not</span> <span class="literal">null</span>, <span class="keyword">add</span> primary <span class="keyword">key</span>(_id);</span><br></pre></td></tr></table></figure>
<p>在表<code>bone</code> 中新增一个<code>_id</code> 字段为整型、自动增长、非空，并将其设为主键。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> bone</span><br><span class="line"><span class="keyword">WHERE</span> lblCollectionUnicode <span class="keyword">IN</span> ( <span class="keyword">SELECT</span> * <span class="keyword">FROM</span>(</span><br><span class="line">        <span class="keyword">SELECT</span> lblCollectionUnicode <span class="keyword">FROM</span> bone </span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line">			lblCollectionUnicode </span><br><span class="line">        <span class="keyword">HAVING</span> </span><br><span class="line">			<span class="keyword">count</span>(lblCollectionUnicode) &gt; <span class="number">1</span> )<span class="keyword">as</span> temp1)</span><br><span class="line"><span class="keyword">AND</span> _id <span class="keyword">NOT</span> <span class="keyword">IN</span> (<span class="keyword">SELECT</span> * <span class="keyword">FROM</span>( </span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(_id) <span class="keyword">FROM</span> bone </span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">			lblCollectionUnicode</span><br><span class="line">		<span class="keyword">HAVING</span></span><br><span class="line">			<span class="keyword">count</span>(lblCollectionUnicode) &gt; <span class="number">1</span> )<span class="keyword">as</span> temp2);</span><br></pre></td></tr></table></figure>
<p>按照<code>lblCollectionUnicode</code> 的取值分组，其中元组数大于1的组有重复数据。利用<code>MIN()</code> 函数取得每组中<code>_id</code> 值最小的元组并将其排除在外，删除元组数大于1的组中的其余数据，即只保留一条数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> bone</span><br><span class="line"><span class="keyword">WHERE</span> lblCollectionUnicode <span class="keyword">IN</span> (</span><br><span class="line">        <span class="keyword">SELECT</span> lblCollectionUnicode <span class="keyword">FROM</span> bone </span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> </span><br><span class="line">			lblCollectionUnicode </span><br><span class="line">        <span class="keyword">HAVING</span> </span><br><span class="line">			<span class="keyword">count</span>(lblCollectionUnicode) &gt; <span class="number">1</span> )</span><br><span class="line"><span class="keyword">AND</span> _id <span class="keyword">NOT</span> <span class="keyword">IN</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="keyword">MIN</span>(_id) <span class="keyword">FROM</span> bone </span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">			lblCollectionUnicode</span><br><span class="line"> 		<span class="keyword">HAVING</span></span><br><span class="line"> 			<span class="keyword">count</span>(lblCollectionUnicode) &gt; <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p> MYSQL执行上述语句报错：</p>
<p> 报错信息如下：</p>
<p> 　　<code>错误代码： 1093</code><br> 　　<code>You can&#39;t specify target table &#39;bone&#39; for update in FROM clause</code></p>
<p>意思是不能在同一语句中更新select出的同一张表元组的属性值</p>
<p>解决方法：将select出的结果通过中间表再select一遍即可。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> bone <span class="keyword">change</span> _id _id <span class="built_in">INT</span>(<span class="number">10</span>);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> bone <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> bone <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(lblCollectionUnicode);</span><br></pre></td></tr></table></figure>
<p>删除自增长后再删除主键，然后将<code>lblCollectionUnicode</code> 设置为主键。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/10/20/使用子查询和联结表/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/10/20/使用子查询和联结表/" class="post-title-link" itemprop="url">使用子查询和联结表</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-20 19:15:34" itemprop="dateCreated datePublished" datetime="2017-10-20T19:15:34+08:00">2017-10-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/计算机科学/" itemprop="url" rel="index"><span itemprop="name">计算机科学</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/计算机科学/数据库/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/计算机科学/数据库/MySQL必知必会/" itemprop="url" rel="index"><span itemprop="name">MySQL必知必会</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="使用子查询和联结表"><a href="#使用子查询和联结表" class="headerlink" title="使用子查询和联结表"></a>使用子查询和联结表</h1><h2 id="使用子查询"><a href="#使用子查询" class="headerlink" title="使用子查询"></a>使用子查询</h2><h3 id="利用子查询进行过滤"><a href="#利用子查询进行过滤" class="headerlink" title="利用子查询进行过滤"></a>利用子查询进行过滤</h3><p>假设：</p>
<p>订单存储在两个表中。对于包含订单号、客户ID、订单日期的每个订单，<code>orders</code>表存储一行，各订单的物品存储在相关的<code>orderitems</code>表中。<code>orders</code> 表不存储客户信息。它只存储客户的ID。实际的客户信息存储在<code>customers</code>表中。</p>
<p>现在假如需要列出订购物品<code>TNT2</code> 的所有客户，应该怎样检索？</p>
<ol>
<li>检索包含物品<code>TNT2</code> 的所有订单的编号。</li>
<li>检索具有前一步骤列出的订单编号的所有客户的ID。</li>
<li>检索前一步骤返回的所有客户ID的客户信息。</li>
</ol>
<p>上述每个步骤都可以单独作为一个查询来执行。可以把一条<code>SELECT</code> 语句返回的结果用于另一条<code>SELECT</code> 语句的<code>WHERE</code> 子句。</p>
<p>也可以使用<strong>子查询</strong>来把3个查询组合成一条语句。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cust_name, cust_contact </span><br><span class="line"><span class="keyword">from</span> customers </span><br><span class="line"><span class="keyword">where</span> cust_id <span class="keyword">in</span> (<span class="keyword">select</span> cust_id </span><br><span class="line">                  <span class="keyword">from</span> orders </span><br><span class="line">                  <span class="keyword">where</span> order_num <span class="keyword">in</span> (<span class="keyword">select</span> order_num </span><br><span class="line">                                      <span class="keyword">from</span> orderitems </span><br><span class="line">                                      <span class="keyword">where</span> prod_id = <span class="string">'TNT2'</span>));</span><br></pre></td></tr></table></figure>
<p>为了执行上述<code>SELECT</code> 语句，MySQL实际上必须执行3条<code>SELECT</code> 语句。最里面的子查询返回订单号列表，此列表用于其外面的子查询的<code>WHERE</code> 子句。外面的子查询返回客户ID列表，此客户ID列表用于最外层查询的<code>WHERE</code> 子句。最外层查询确实返回所需的数据。</p>
<p>可见，在<code>WHERE</code> 子句中使用子查询能够编写出功能很强并且很灵活的SQL语句。对于能嵌套的子查询的数目没有限制，不过由于在实际使用时由于性能的限制，不能嵌套太多的子查询。</p>
<blockquote>
<p><strong>列必须匹配</strong> 在<code>WHERE</code> 子句中使用子查询，应该保证<code>SELECT</code> 语句具有与<code>WHERE</code> 子句中相同数目的列。通常，子查询将返回单个列并且与单个列匹配，但如果需要也可以使用多个列。</p>
</blockquote>
<h3 id="作为计算字段使用子查询"><a href="#作为计算字段使用子查询" class="headerlink" title="作为计算字段使用子查询"></a>作为计算字段使用子查询</h3><p>使用子查询的另一方法是创建计算字段。假如需要显示<code>customers</code> 表中每个客户的订单总数。订单与相应的客户ID存储在<code>orders</code> 表中。</p>
<p>为了执行这个操作，遵循下面的步骤。</p>
<ol>
<li>从<code>customers</code> 表中检索客户列表。</li>
<li>对于检索出的每个客户，统计其在<code>orders</code> 表中的订单数目。</li>
</ol>
<p>为了对每个客户执行<code>COUNT(*)</code> 计算，应该把<code>COUNT(*)</code> 作为一个子查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cust_name, </span><br><span class="line">       cust_state, </span><br><span class="line">       (<span class="keyword">select</span> <span class="keyword">count</span>(*) </span><br><span class="line">       <span class="keyword">from</span> orders </span><br><span class="line">       <span class="keyword">where</span> orders.cust_id = customers.cust_id) <span class="keyword">as</span> orders</span><br><span class="line"><span class="keyword">from</span> customers </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> cust_name;</span><br></pre></td></tr></table></figure>
<p>这条<code>SELECT</code> 语句对<code>customers</code> 表中每个客户返回3列：<code>cust_name</code> 、<code>cust_state</code> 、和<code>orders</code> 。<code>orders</code> 是一个计算字段，它是由圆括号中的子查询建立的。该子查询对检索出的每个客户执行一次。在此例子中，该子查询执行了5次，因为检索出了5个客户。</p>
<p>子查询中的<code>WHERE</code> 子句和前面使用的<code>WHERE</code> 子句稍有不同，因为它使用了完全限定列名。下面的语句告诉SQL比较<code>orders</code> 表中的<code>cust_id</code> 与当前正从<code>customers</code> 表中检索出的<code>cust_id</code> ：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where orders.cust_id = customers.cust_id</span><br></pre></td></tr></table></figure>
<p><strong>相关子查询 (correlated subquery)</strong> 涉及外部查询的子查询。</p>
<p>这种类型的子查询称为<strong>相关子查询</strong> 。任何时候只要列名可能有多义性，就必须使用这种语法（表名和列名由一个句点分隔）。</p>
<blockquote>
<p><strong>逐渐增加子查询来建立查询 </strong></p>
<p>用子查询测试和调试查询很有技巧性，特别是在这些语句的复杂性不断增加的情况下更是如此。用子查询建立（和测试）查询的最可靠的方法是逐渐进行，这与MySQL处理它们的方法非常相同。首先，建立和测试最内层的查询。然后，用硬编码数据建立和测试外层查询，并且仅在确认它正常后才嵌入子查询。这时，再次测试它。对于要增加的每个查询，重复这些步骤。这样做仅给构造查询增加了一点点时间，但节省了以后（找出查询为什么不正常）的大量时间，并且极大地提高了查询一开始就正常工作的可能性。</p>
</blockquote>
<h2 id="联结表"><a href="#联结表" class="headerlink" title="联结表"></a>联结表</h2><h2 id="联结"><a href="#联结" class="headerlink" title="联结"></a>联结</h2><p>SQL最强大的功能之一，就是能在数据检索查询的执行中联结（join）表。</p>
<h3 id="关系表"><a href="#关系表" class="headerlink" title="关系表"></a>关系表</h3><p>理解关系表的最好方法是来看一个现实世界中的例子。</p>
<p>假如有一个包含产品目录的数据库表，其中每种类比的物品占一行。对于每种物品要存储的信息包括产品描述和价格，以及生产该产品的供应商信息。</p>
<p>现在，假如有由同一供应商生产的多种物品，那么在何处存储供应商信息（如，供应商名、地址、联系方式等）呢？将这些数据与产品信息分开存储的理由如下。</p>
<ul>
<li>因为同一供应商生产的每个产品的供应商信息都是相同的，对每个产品重复此信息既浪费时间又浪费存储空间。</li>
<li>如果供应商信息改变（例如，供应商搬家或电话号码变动），只需改动一次即可。</li>
<li>如果有重复数据（即每种商品都储存供应商信息），很难保证每次输入该数据的方式都相同。不一致的数据在报表中很难利用。</li>
</ul>
<p>关键是，相同数据出现多次绝不是一件好事，此因素是关系数据库设计的基础，关系表的设计就是要保证吧信息分解成多个表，一类数据一个表。各表通过某些常用的值（即关系设计中的<strong>关系（relational）</strong>互相关联）</p>
<p>在这个例子中可以建立两个表，一个存储供应商信息，另一个存储产品信息。<code>vendors</code> 表包含所有供应商信息，每个供应商占一行，每个供应商具有唯一的标识，此标识称为<strong>主键（primary key）</strong> ， 可以是供应商ID或任何其他唯一值。</p>
<p><code>products</code>表只存储产品信息，它除了存储供应商ID（<code>vendors</code>表的主键）外不存储其他供应商信息。<code>vendors</code>表的主键又叫做<code>products</code>的外键，它将<code>vendors</code>表与<code>products</code>表相关联，利用供应商ID能从<code>vendors</code>表中找出相应供应商的详细信息。</p>
<blockquote>
<p><strong>外键（foreign key）</strong> 外键为某个表中的一列，它包含另一个表的主键值，定义了两个表之间的关系。</p>
<p>这样做的好处如下：</p>
<ul>
<li>供应商信息不重复，从而不浪费时间和空间；</li>
<li>如果供应商信息变动， 可以只更新<code>vendors</code>表中的单个记录，相关表中的数据不用改动；</li>
<li>由于数据无重复，显然数据是一致的，这使得处理数据更简单。</li>
</ul>
<p>总之，关系数据可以有效的存储和方便的处理。因此，关系数据库的可伸缩性远比非关系数据库要好。</p>
<p><strong>可伸缩性（scale）</strong> 能够适应不断增加的工作量而不失败。设计良好的数据库或应用程序称之为<strong>可伸缩性好（scale well）</strong>。 </p>
</blockquote>
<h3 id="为什么要使用联结"><a href="#为什么要使用联结" class="headerlink" title="为什么要使用联结"></a>为什么要使用联结</h3><p>正如所述，分解数据为多个表能更有效地存储，更方便地处理，并且具有更大的可伸缩性。但这些好处是有代价的。</p>
<p>如果数据存储在多个表中，怎样用单条<code>select</code> 语句检索出数据？</p>
<p>答案是使用联结。简单的说，联结是一种机制，用来在一条<code>select</code>语句中关联表 ，因此称之为联结。使用特殊的语法，可以联结多个表返回同一组输出，联结在运行时关联表中正确的行。</p>
<blockquote>
<p><strong>维护引用完整性</strong>  重要的是，要理解联结不是物理实体。换句话说，它在实际的数据库表中并不存在，联结由MySQL根据需要建立，它存在于查询的执行当中。</p>
<p>在使用关系表时，仅在关系列中插入合法的数据非常重要，回到这里的例子，如果在<code>products</code>表中插入非法供应商ID（即没有在<code>vendors</code>表中出现 ）的供应商生产的商品，则这些产品是不可访问的，因为它们没有关联到某个供应商。</p>
<p>为防止这种情况发生，可指示MySQL只允许在<code>products</code>表的供应商ID列中出现合法值（即出现在<code>vendors</code>表中的供应商）。这就是维护引用完整性，它是通过在表的定义中指定主键和外键来实现的。 </p>
</blockquote>
<h3 id="创建联结"><a href="#创建联结" class="headerlink" title="创建联结"></a>创建联结</h3><p>联结的创建非常简单，规定要联结的所有表以及它们如何关联即可。请看下面的例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vend_name, prod_name, prod_price</span><br><span class="line"><span class="keyword">from</span> vendors, products</span><br><span class="line"><span class="keyword">where</span> vendors.vend_id = products.vend_id</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> vend_name, prod_name;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>完全限定列名</strong> 在引用的列可能出现二义性时，必须使用完全限定列名（用一个点分隔的表名和列名）。如果引用一个没有用表名限制的具有二义性的列名，MySQL将返回错误。</p>
</blockquote>
<h3 id="内部联结"><a href="#内部联结" class="headerlink" title="内部联结"></a>内部联结</h3><p>目前为止所用的联结成为<strong>等值联结（equijoin）</strong> ，它基于两个表之间的相等测试。这种联结也称为<strong>内部联结</strong> 。其实对于这种联结可以使用稍微不同的语法来明确指定联结的类型。下面的<code>select</code> 语句返回与前面例子完全相同的数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> vend_name, prod_name, prod_price</span><br><span class="line"><span class="keyword">from</span> vendors <span class="keyword">inner</span> <span class="keyword">join</span> products</span><br><span class="line"><span class="keyword">on</span> vendors.vend_id = products.vend_id;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh_Hans">
    <link itemprop="mainEntityOfPage" href="https://ningoy.github.io/2017/10/01/《The Django Book》读书笔记二/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/ningoy.github.io/images/avatar.gif">
      <meta itemprop="name" content="Lenin">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="关爱颈椎成长协会">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/ningoy.github.io/2017/10/01/《The Django Book》读书笔记二/" class="post-title-link" itemprop="url">《The Django Book》读书笔记二</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-10-01 16:32:55" itemprop="dateCreated datePublished" datetime="2017-10-01T16:32:55+08:00">2017-10-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-27 18:45:35" itemprop="dateModified" datetime="2020-01-27T18:45:35+08:00">2020-01-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/计算机科学/" itemprop="url" rel="index"><span itemprop="name">计算机科学</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/计算机科学/软件框架/" itemprop="url" rel="index"><span itemprop="name">软件框架</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/ningoy.github.io/categories/读书笔记/计算机科学/软件框架/The-Django-Book/" itemprop="url" rel="index"><span itemprop="name">The Django Book</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="《The-Django-Book》读书笔记二"><a href="#《The-Django-Book》读书笔记二" class="headerlink" title="《The Django Book》读书笔记二"></a>《The Django Book》读书笔记二</h1><h2 id="MTV开发模式"><a href="#MTV开发模式" class="headerlink" title="MTV开发模式"></a>MTV开发模式</h2><p>把数据存取逻辑、业务逻辑和表现逻辑组合在一起的概念有时被称为软件架构的<em>Model-View-Controller</em>(MVC)模式。在这个模式中，Model代表数据存取层，View代表的是系统中选择显示什么和怎么显示的部分，Controller指的是系统中根据用户输入并视需要访问模型，以决定使用哪个视图的那部分。</p>
<p>Django紧紧地遵循这种MVC模式，可以称得上是一种MVC框架。以下是Django中M、V和C各自的含义：</p>
<ul>
<li>M， 数据存取部分，由Django数据库层处理。</li>
<li>V， 选择显示哪些数据要显示以及怎样显示的部分，由视图和模板处理。</li>
<li>C， 根据用户输入委派视图的部分，由Django框架根据URLconf设置，对给定URL调用适当的Python函数。</li>
</ul>
<p>由于C由框架自行处理，而Django里更关注的是模型（Model）、模板（Template）和视图（Views），Django也被成为MTV框架。在MTV开发模式中：</p>
<ul>
<li>M代表模型（Model），即数据存取层。该层处理与数据相关的所有事务：如何存取、如何验证有效性、包含哪些行为以及数据之间的关系等，</li>
<li>T代表模板（Template），即表现层。该层处理和表现相关的决定：如何在页面或其他类型文档中进行显示。</li>
<li>V代表视图（View），即业务逻辑层。该层包含存取模型及调取恰当模板的相关逻辑，你可以把它看作模型与模板之间的桥梁。</li>
</ul>
<h2 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h2><p>首先，完成数据库服务器的安装和激活，并在其中建立数据库。然后，在Django的配置文件里，缺省是<code>settings.py</code>，打开这个文件并查找数据库配置：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'mydb'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'password'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>之后，如有必要的话，可以在<code>__init__.py</code>文件中加上这两行：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure>
<h2 id="第一个应用程序"><a href="#第一个应用程序" class="headerlink" title="第一个应用程序"></a>第一个应用程序</h2><p>接下来创建一个Django APP，一个包含模型，视图和Django代码，并且形式为独立Python包的完整Django应用。</p>
<h3 id="关于project和app的区别"><a href="#关于project和app的区别" class="headerlink" title="关于project和app的区别"></a>关于project和app的区别</h3><ul>
<li>一个project包含很多个Django app以及对它们的配置。</li>
<li>技术上,project的作用是提供配置文件，比方说哪里定义数据库连接信息，安装的app列表，<code>TEMPLATE_DIRS</code>， 等等。</li>
<li>一个app是一套Django功能的集合，通常包括模型和视图，按Python包结构的方式存在。</li>
<li>例如，Django本身内建有一些app，例如注释系统和自动管理界面。app的一个关键点是它们是很容易移植到其他project和被多个project复用。</li>
</ul>
<p>对于如何架构Django代码并没有快速成套的规则。如果你只是建造一个简单的Web站点，那么可能你只需要一个app就可以了；但如果是一个包含许多不相关模块的复杂的网站，例如电子商务和社区之类的站点，那么你可能需要把这些模块划分成不同的app，以便日后复用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/ningoy.github.io/page/2/">2</a><a class="extend next" rel="next" href="/ningoy.github.io/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lenin</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/ningoy.github.io/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/ningoy.github.io/categories/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/ningoy.github.io/tags/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lenin</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.2
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/ningoy.github.io/lib/anime.min.js"></script>
  <script src="/ningoy.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/ningoy.github.io/lib/velocity/velocity.ui.min.js"></script>
<script src="/ningoy.github.io/js/utils.js"></script><script src="/ningoy.github.io/js/motion.js"></script>
<script src="/ningoy.github.io/js/schemes/muse.js"></script>
<script src="/ningoy.github.io/js/next-boot.js"></script>



  















  

  

</body>
</html>
